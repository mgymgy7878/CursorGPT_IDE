### ai_generate_429_spike.yml
groups:
- name: ai-generate-rate-limit
  rules:
  - alert: ai_generate_429_spike
    expr: rate(http_requests_total{status="429",route="/api/ai/generate"}[5m]) > 1
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "AI generate 429 spike (>1 r/s, 5m)"
      description: "Rate limit errors exceeded 1 request/second over the last 5 minutes for /api/ai/generate."




### ai_generate_error_rate.yml
groups:
- name: ai-generate-error-rate
  rules:
  - alert: ai_generate_error_rate_gt_1pct
    expr: (sum(rate(ai_generate_total{status!~"2xx"}[5m])) / sum(rate(ai_generate_total[5m]))) > 0.01 and sum(increase(ai_generate_total[5m])) > 50
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: AI generate error rate > 1% (5m) with >50 req/5m
      description: Non-2xx ratio exceeded 1% over 5m with more than 50 requests in the same window.



### ai_generate_fallback.yml
groups:
- name: ai-generate-fallback
  rules:
  - alert: ai_generate_fallback_gt_3pct_with_p95_2800
    expr: (sum(rate(ai_generate_total{fallback="yes"}[5m])) / sum(rate(ai_generate_total[5m])) > 0.03) and (histogram_quantile(0.95, sum by (le) (rate(ai_latency_ms_bucket[5m]))) > 2800)
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: AI generate fallback > 3% (5m) with p95 > 2.8s
      description: Fallback ratio exceeded 3% and p95 latency above 2.8s over the last 5 minutes.



### ai_generate_p95.yml
groups:
- name: ai-generate-latency
  rules:
  - alert: AI_Generate_P95_Too_High
    expr: |
      histogram_quantile(0.95, sum by (le) (rate(ai_latency_ms_bucket[5m]))) > 3000
    for: 3m
    labels:
      severity: warning
      service: executor
    annotations:
      summary: "AI Generate p95 yÃ¼ksek"
      description: "p95 > 3000ms (son 5dk)."


### ai_generate_p95_high.yml
groups:
- name: ai-generate-latency-guard
  rules:
  - alert: ai_generate_p95_high_10m
    expr: histogram_quantile(0.95, sum by (le) (rate(ai_latency_ms_bucket[5m]))) > 2800
    for: 10m
    labels:
      severity: warning
      service: executor
    annotations:
      summary: "AI generate p95 > 2.8s (10m)"
      description: "p95 latency above 2.8s for 10 minutes."




