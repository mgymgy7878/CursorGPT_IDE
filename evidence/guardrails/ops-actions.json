{
  "alerts": [
    {
      "action": "alerts/create",
      "params": {
        "name": "Guardrails 4xx rate high",
        "expr": "sum(rate(guardrails_4xx_total[5m])) / sum(rate(http_requests_total{route=~\"/guardrails/params/.*\"}[5m])) > 0.02",
        "for": "5m",
        "severity": "warning",
        "labels": {"team":"platform","service":"executor"},
        "annotations": {"summary":"Guardrails 4xx > 2% (5m)","runbook":"RBAC/allowlist/header kontrolü"}
      },
      "dryRun": false,
      "confirm_required": false,
      "reason": "Kötü kullanım/rol hatası erken uyarı"
    },
    {
      "action": "alerts/create",
      "params": {
        "name": "Audit write errors",
        "expr": "increase(audit_write_errors_total[5m]) > 0",
        "for": "1m",
        "severity": "critical",
        "labels": {"team":"platform","service":"executor"},
        "annotations": {"summary":"Audit JSONL yazım hatası","runbook":"disk izinleri, fsync, rotasyon"}
      },
      "dryRun": false,
      "confirm_required": false,
      "reason": "Kanıt zincirinin güvenliği"
    }
  ],
  "canary": {
    "action": "canary/run",
    "params": {
      "suite": "guardrails-prod-preflight",
      "steps": [
        {"name":"viewer-denied","call":"GET /admin/params","headers":{"x-role":"viewer","X-Actor":"qa@local"}},
        {"name":"admin-ok","call":"GET /admin/params","headers":{"x-role":"admin","X-Actor":"qa@local"}},
        {"name":"audit-check","call":"GET /api/guardrails/params/audit?limit=10","headers":{"x-role":"admin","X-Actor":"qa@local"}}
      ]
    },
    "dryRun": true,
    "confirm_required": false,
    "reason": "Prod öncesi RBAC+Audit görünürlüğü kanıtı"
  }
}
