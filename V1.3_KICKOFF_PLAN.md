# SPARK V1.3 KICKOFF PLAN

**Status:** Bootstrap Ready  
**Start Date:** 2025-01-18  
**Target Completion:** 2025-01-25 (7 days)

---

## ðŸŽ¯ V1.3 Objectives

### 1. BTCTurk Spot WebSocket Integration
- âœ… WS client created (`services/marketdata/src/ws/btcturk.ts`)
- âœ… Reconnect logic with exponential backoff + jitter
- âœ… Heartbeat mechanism (30s ping)
- ðŸ”œ Real-time ticker/orderbook/trades streaming
- ðŸ”œ Integration with Dashboard `MarketCard`

### 2. BIST Feed Integration
- ðŸ”œ Polling mechanism (HTTP REST)
- ðŸ”œ Buffer & normalize BIST data
- ðŸ”œ Cache layer (Redis or in-memory)
- ðŸ”œ BIST `MarketCard` live updates

### 3. Copilot Guardrails
- ðŸ”œ Param-diff approval UI
- ðŸ”œ Risk scoring card
- ðŸ”œ Action JSON preview modal
- ðŸ”œ Confirmation workflow

### 4. Observability Enhancement
- âœ… Prometheus config updated (`ops/prometheus.yml`)
- âœ… Alert rules created (`ops/alerts/spark.rules.yml`)
- âœ… Grafana dashboard (`ops/grafana/dashboards/spark-overview.json`)
- ðŸ”œ Grafana deployment & integration
- ðŸ”œ Alert notification setup (Slack/Email)

### 5. Strategy Lab Full Flow
- ðŸ”œ Generate: AI prompt â†’ strategy code
- ðŸ”œ Backtest: Strategy code â†’ backtest results
- ðŸ”œ Optimize: Param grid search â†’ best params
- ðŸ”œ Job log modal (real-time updates)
- ðŸ”œ Strategy storage & versioning

---

## ðŸ“¦ Deliverables

### Phase 1: Real-time Data (Days 1-2)
- [ ] BTCTurk WS client fully integrated
- [ ] Dashboard `MarketCard` live updates
- [ ] BIST polling service
- [ ] Data normalization helpers

### Phase 2: Guardrails & Safety (Days 3-4)
- [ ] Copilot param-diff UI
- [ ] Risk scoring algorithm
- [ ] Action confirmation modal
- [ ] Audit log for actions

### Phase 3: Observability (Days 5-6)
- [ ] Grafana deployed & configured
- [ ] Dashboards accessible via UI
- [ ] Alerts integrated with notification channels
- [ ] Observability page enhanced with Grafana embeds

### Phase 4: Strategy Lab (Day 7)
- [ ] Full Generate â†’ Backtest â†’ Optimize flow
- [ ] Job execution & monitoring
- [ ] Strategy storage backend
- [ ] Results visualization

---

## ðŸ”§ Technical Stack

### New Dependencies
- `ws` (WebSocket client) - Already in `marketdata`
- `ioredis` (Redis client) - For caching
- `@grafana/ui` (Optional: Grafana embeds)
- `openai` (AI strategy generation)

### Infrastructure
- Redis container (docker-compose)
- Grafana container (docker-compose)
- Alertmanager container (docker-compose)

---

## ðŸ“Š Success Criteria

### BTCTurk WS
- âœ… Connection stable for 24h+ without manual restart
- âœ… Reconnect on disconnect < 5s
- âœ… Data latency < 100ms

### BIST Feed
- âœ… Polling interval < 10s
- âœ… Cache hit rate > 80%
- âœ… Data staleness < 30s

### Copilot Guardrails
- âœ… All high-risk actions require confirmation
- âœ… Risk score displayed before execution
- âœ… Audit log captures all actions

### Observability
- âœ… Grafana dashboards accessible
- âœ… Alerts fire correctly (tested)
- âœ… P95 latency visible in real-time

### Strategy Lab
- âœ… Generate â†’ Backtest â†’ Optimize flow complete
- âœ… Job execution < 30s for simple strategy
- âœ… Results stored & retrievable

---

## ðŸš€ Quick Start Commands

### Start Infrastructure
```bash
docker-compose up -d redis grafana alertmanager
```

### Run BTCTurk WS Client
```bash
cd services/marketdata
pnpm dev
```

### Deploy Grafana Dashboard
```bash
curl -X POST http://admin:admin@localhost:3000/api/dashboards/db \
  -H "Content-Type: application/json" \
  -d @ops/grafana/dashboards/spark-overview.json
```

### Test Alerts
```bash
curl -X POST http://localhost:9093/api/v1/alerts \
  -H "Content-Type: application/json" \
  -d '[{"labels":{"alertname":"TestAlert","severity":"warning"}}]'
```

---

## ðŸ“ˆ Milestones

| Milestone | Date | Status |
|-----------|------|--------|
| V1.2 Release | 2025-01-17 | âœ… DONE |
| BTCTurk WS Ready | 2025-01-19 | ðŸ”œ IN PROGRESS |
| BIST Feed Ready | 2025-01-20 | ðŸ”œ PENDING |
| Copilot Guardrails | 2025-01-22 | ðŸ”œ PENDING |
| Observability Enhanced | 2025-01-24 | ðŸ”œ PENDING |
| Strategy Lab Complete | 2025-01-25 | ðŸ”œ PENDING |
| V1.3 Release | 2025-01-25 | ðŸ”œ PENDING |

---

## ðŸ”— References

- [BTCTurk API Docs](https://docs.btcturk.com/)
- [BIST Data Feed Spec](./docs/BIST_VENDOR_PROBE_PLAN.md)
- [Grafana Dashboard Config](./ops/grafana/dashboards/spark-overview.json)
- [Alert Rules](./ops/alerts/spark.rules.yml)
- [Strategy Lab Guide](./docs/backtest/H1_BACKTEST_ENGINE_GUIDE.md)

---

**Next Action:** Bootstrap BTCTurk WS integration & test live ticker stream

*Spark Trading Platform - V1.3 Kickoff*  
*"Real-time Data â€¢ Guardrails â€¢ Enhanced Observability â€¢ Full Strategy Lab"* ðŸš€ðŸ“ŠðŸ›¡ï¸âš¡

