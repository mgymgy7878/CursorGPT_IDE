# SPARK V1.3 KICKOFF PLAN

**Status:** Bootstrap Ready  
**Start Date:** 2025-01-18  
**Target Completion:** 2025-01-25 (7 days)

---

## 🎯 V1.3 Objectives

### 1. BTCTurk Spot WebSocket Integration
- ✅ WS client created (`services/marketdata/src/ws/btcturk.ts`)
- ✅ Reconnect logic with exponential backoff + jitter
- ✅ Heartbeat mechanism (30s ping)
- 🔜 Real-time ticker/orderbook/trades streaming
- 🔜 Integration with Dashboard `MarketCard`

### 2. BIST Feed Integration
- 🔜 Polling mechanism (HTTP REST)
- 🔜 Buffer & normalize BIST data
- 🔜 Cache layer (Redis or in-memory)
- 🔜 BIST `MarketCard` live updates

### 3. Copilot Guardrails
- 🔜 Param-diff approval UI
- 🔜 Risk scoring card
- 🔜 Action JSON preview modal
- 🔜 Confirmation workflow

### 4. Observability Enhancement
- ✅ Prometheus config updated (`ops/prometheus.yml`)
- ✅ Alert rules created (`ops/alerts/spark.rules.yml`)
- ✅ Grafana dashboard (`ops/grafana/dashboards/spark-overview.json`)
- 🔜 Grafana deployment & integration
- 🔜 Alert notification setup (Slack/Email)

### 5. Strategy Lab Full Flow
- 🔜 Generate: AI prompt → strategy code
- 🔜 Backtest: Strategy code → backtest results
- 🔜 Optimize: Param grid search → best params
- 🔜 Job log modal (real-time updates)
- 🔜 Strategy storage & versioning

---

## 📦 Deliverables

### Phase 1: Real-time Data (Days 1-2)
- [ ] BTCTurk WS client fully integrated
- [ ] Dashboard `MarketCard` live updates
- [ ] BIST polling service
- [ ] Data normalization helpers

### Phase 2: Guardrails & Safety (Days 3-4)
- [ ] Copilot param-diff UI
- [ ] Risk scoring algorithm
- [ ] Action confirmation modal
- [ ] Audit log for actions

### Phase 3: Observability (Days 5-6)
- [ ] Grafana deployed & configured
- [ ] Dashboards accessible via UI
- [ ] Alerts integrated with notification channels
- [ ] Observability page enhanced with Grafana embeds

### Phase 4: Strategy Lab (Day 7)
- [ ] Full Generate → Backtest → Optimize flow
- [ ] Job execution & monitoring
- [ ] Strategy storage backend
- [ ] Results visualization

---

## 🔧 Technical Stack

### New Dependencies
- `ws` (WebSocket client) - Already in `marketdata`
- `ioredis` (Redis client) - For caching
- `@grafana/ui` (Optional: Grafana embeds)
- `openai` (AI strategy generation)

### Infrastructure
- Redis container (docker-compose)
- Grafana container (docker-compose)
- Alertmanager container (docker-compose)

---

## 📊 Success Criteria

### BTCTurk WS
- ✅ Connection stable for 24h+ without manual restart
- ✅ Reconnect on disconnect < 5s
- ✅ Data latency < 100ms

### BIST Feed
- ✅ Polling interval < 10s
- ✅ Cache hit rate > 80%
- ✅ Data staleness < 30s

### Copilot Guardrails
- ✅ All high-risk actions require confirmation
- ✅ Risk score displayed before execution
- ✅ Audit log captures all actions

### Observability
- ✅ Grafana dashboards accessible
- ✅ Alerts fire correctly (tested)
- ✅ P95 latency visible in real-time

### Strategy Lab
- ✅ Generate → Backtest → Optimize flow complete
- ✅ Job execution < 30s for simple strategy
- ✅ Results stored & retrievable

---

## 🚀 Quick Start Commands

### Start Infrastructure
```bash
docker-compose up -d redis grafana alertmanager
```

### Run BTCTurk WS Client
```bash
cd services/marketdata
pnpm dev
```

### Deploy Grafana Dashboard
```bash
curl -X POST http://admin:admin@localhost:3000/api/dashboards/db \
  -H "Content-Type: application/json" \
  -d @ops/grafana/dashboards/spark-overview.json
```

### Test Alerts
```bash
curl -X POST http://localhost:9093/api/v1/alerts \
  -H "Content-Type: application/json" \
  -d '[{"labels":{"alertname":"TestAlert","severity":"warning"}}]'
```

---

## 📈 Milestones

| Milestone | Date | Status |
|-----------|------|--------|
| V1.2 Release | 2025-01-17 | ✅ DONE |
| BTCTurk WS Ready | 2025-01-19 | 🔜 IN PROGRESS |
| BIST Feed Ready | 2025-01-20 | 🔜 PENDING |
| Copilot Guardrails | 2025-01-22 | 🔜 PENDING |
| Observability Enhanced | 2025-01-24 | 🔜 PENDING |
| Strategy Lab Complete | 2025-01-25 | 🔜 PENDING |
| V1.3 Release | 2025-01-25 | 🔜 PENDING |

---

## 🔗 References

- [BTCTurk API Docs](https://docs.btcturk.com/)
- [BIST Data Feed Spec](./docs/BIST_VENDOR_PROBE_PLAN.md)
- [Grafana Dashboard Config](./ops/grafana/dashboards/spark-overview.json)
- [Alert Rules](./ops/alerts/spark.rules.yml)
- [Strategy Lab Guide](./docs/backtest/H1_BACKTEST_ENGINE_GUIDE.md)

---

**Next Action:** Bootstrap BTCTurk WS integration & test live ticker stream

*Spark Trading Platform - V1.3 Kickoff*  
*"Real-time Data • Guardrails • Enhanced Observability • Full Strategy Lab"* 🚀📊🛡️⚡

