# Release PR — v2.0.0: Online Predict GA & Risk-Aware Pipeline

## Summary
This release promotes our online prediction service to GA, introduces a risk-aware signal pipeline (daily risk reports, advisor integration), and hardens the public proxy while preserving POST-only semantics and SSE passthrough. Observability and operational runbooks are included.

## What Changed
### Executor / Backend
- Online predict with persistent LRU+TTL cache (snapshot/rehydrate), token-bucket rate limit, and detailed metrics.
- Shadow A/B scoring (read-only): logs candidate vs prod; feeds daily risk report.
- Retrain suggest + optional AUTO cron produces artifacts and draft models.
- New Fusion endpoints + Prometheus metrics (freshness, PSI, cache, latency).

### Web / Proxy
- Proxy POST allowlist extended; 429 propagation (retry-after, retryAfterMs) standardized.
- SSE passthrough kept; streaming headers hardened.
- App Router pages normalized (`dynamic='force-dynamic'`, `revalidate=0`).

### Data & Storage
- db-lite fallback for shadow logs & report manifests; PG schema/migrations optional.

## Ops Notes
### ENV
- Web: `EXECUTOR_BASE=http://127.0.0.1:4001`
- Executor:
  - `FUSION_ONLINE_CACHE_SNAPSHOT=./evidence/cache/fusion_online_cache.json`
  - `RISK_REPORT_DIR=./evidence/reports`

### Start
```
pnpm run dev:both
```

### Smoke
```
pnpm run release:smoke
```
- Web health 200, Prometheus `# HELP`, canary JSON 200, risk ZIP > 0 B

### Metrics
- Use `GET /api/public/metrics` (POST intentionally 405)

### 429 Handling
- Respect `retry-after` header and body `retryAfterMs`.

## Backward Compatibility
- No breaking API changes; POST-only proxy policy maintained. Existing GET exceptions (metrics/SSE/health) unchanged.

## Testing / QA
- Health: 200 on web + executor
- Risk report: ZIP downloadable via proxy
- Retrain suggest: returns `ok:true`, reasons, draft model id, artifacts
- Shadow logs recorded (prod decision unchanged)

## Rollout Plan
- Tag & publish:
```
pnpm -w build
git tag v2.0.0 && git push origin v2.0.0
```
- (Optional) Enable PG migrations; schedule nightly `risk.report.daily` + smoke + artifact upload.

## Rollback
- Disable candidate (shadow): set candidate to `null`
- Tighten thresholds/rate limit; revert to previous tag (v1.5) if required.

## Known Gaps / Next (v2.1)
- Shadow A/B stats (ROC/PR deltas, KS, lift)
- Guarded auto-retrain → promote pipeline
- Redis/PG-backed cache persistence for multi-instance
- Per-symbol risk governance; canary-aware rate control
- Nightly risk report diff + alerting

## Checklist
- [ ] Web & executor health 200
- [ ] `GET /api/public/metrics` shows `# HELP`
- [ ] Canary stats returns JSON
- [ ] Risk report ZIP > 0 B
- [ ] Env files committed to deployment targets 