# V1.3-P3 • UI-Guardrails Harmonization — ÖN PLAN

## 📋 Genel Bakış
P2'de oluşturulan `colors.status.*` token'larını kullanarak UI genelinde durum göstergelerini (alert chip, SLO badge, guardrail status) standartlaştırma ve i18n CI kontrolü ekleme.

## 🎯 Hedefler

1. **StatusBadge Unification**
   - Tek `StatusBadge` bileşeni → `status.*` token'ları kullanır
   - Eski chip/tag/badge bileşenlerini birleştir
   - Alert, SLO, Guardrail durum göstergelerini standartlaştır

2. **i18n CI Gate**
   - `scripts/i18n-check.mjs` → TR/EN anahtar paritesi kontrolü
   - CI'da otomatik yorum (eksik anahtarlar)
   - Pre-commit hook (opsiyonel)

3. **Format Helper Tests**
   - `lib/format.ts` → Jest coverage %100
   - Edge case: negatif, sıfır, çok büyük sayılar, null/undefined

4. **Settings İyileştirmeleri**
   - Tema: "(light)" → "(aydınlık)" (i18n)
   - Dil seçici görsel polish
   - Keyboard shortcuts display

## 📦 Paket İçeriği (Tahmini 12-15 dosya)

### 1. StatusBadge Bileşeni (yeni)
```typescript
// apps/web-next/src/components/ui/StatusBadge.tsx
interface StatusBadgeProps {
  status: 'success' | 'warn' | 'error' | 'info' | 'neutral';
  label: string;
  size?: 'sm' | 'md' | 'lg';
  icon?: ReactNode;
}
```

**Kullanım:**
```tsx
<StatusBadge status="success" label={t('status.healthy')} />
<StatusBadge status="error" label={t('status.down')} icon={<AlertIcon />} />
```

### 2. i18n Check Script
```javascript
// scripts/i18n-check.mjs
// TR/EN JSON'larını karşılaştır
// Eksik anahtarları raporla
// Exit code: 0 (parity) veya 1 (mismatch)
```

**CI Entegrasyonu:**
```yaml
# .github/workflows/ci.yml
- name: i18n Parity Check
  run: pnpm i18n:check
```

### 3. Format Helper Tests
```typescript
// apps/web-next/src/lib/__tests__/format.test.ts
describe('formatCurrency', () => {
  it('formats positive numbers (TR locale)', () => {
    expect(formatCurrency(42500, 'tr-TR', 'USD')).toBe('42.500,00 $');
  });
  it('formats negative numbers', () => {
    expect(formatCurrency(-125.5, 'tr-TR', 'USD')).toBe('-125,50 $');
  });
  it('handles zero', () => {
    expect(formatCurrency(0, 'tr-TR', 'USD')).toBe('0,00 $');
  });
  it('handles very large numbers', () => {
    expect(formatCurrency(1234567890, 'tr-TR', 'USD')).toContain('1.234.567.890');
  });
});
```

### 4. Settings Page Refactor
```typescript
// Theme selector i18n
const themes = [
  { value: 'dark', label: t('settings.theme.dark') },
  { value: 'light', label: t('settings.theme.light') },
  { value: 'system', label: t('settings.theme.system') },
];
```

## 🔄 Migration Path

### Aşama 1: StatusBadge Oluştur
- [ ] Bileşen dosyası
- [ ] Storybook stories
- [ ] Unit tests
- [ ] `status.*` token entegrasyonu

### Aşama 2: Mevcut Kullanımları Değiştir
- [ ] Alert chip'leri → StatusBadge
- [ ] SLOChip → StatusBadge
- [ ] Guardrail status → StatusBadge
- [ ] StatusPills → StatusBadge (opsiyonel, zaten refactor edildi)

### Aşama 3: i18n Tooling
- [ ] `scripts/i18n-check.mjs`
- [ ] `package.json`: `"i18n:check": "node scripts/i18n-check.mjs"`
- [ ] CI workflow güncelle
- [ ] Pre-commit hook (opsiyonel)

### Aşama 4: Format Tests
- [ ] Jest setup
- [ ] `format.test.ts` tüm fonksiyonlar için
- [ ] Coverage gate: %100

### Aşama 5: Settings Polish
- [ ] Tema i18n
- [ ] Dil seçici UX
- [ ] Keyboard shortcuts modal

## 📊 Başarı Kriterleri

| Kriter | Hedef | Ölçüm |
|--------|-------|-------|
| Bileşen Birleşimi | Tek StatusBadge | Eski chip/badge bileşenleri kaldırıldı |
| i18n Parity | %100 TR/EN | CI check geçiyor |
| Test Coverage | %100 format.ts | Jest report |
| Build Size | +2 KB max | Webpack bundle analyzer |
| Performance | <50 ms render | Chrome DevTools |

## ⚠️ Riskler

| Risk | Olasılık | Etki | Azaltma |
|------|----------|------|---------|
| Eski bileşen kullanımı kaldı | Orta | Orta | grep ile scan, deprecation warning |
| i18n check false positive | Düşük | Düşük | Whitelist mekanizması |
| Format test edge case | Orta | Düşük | Comprehensive test suite |

## 🚀 Rollout

1. **P3-Alpha:** StatusBadge + i18n check (1-2 gün)
2. **P3-Beta:** Migration + format tests (2-3 gün)
3. **P3-RC:** Settings polish + QA (1 gün)
4. **P3-Final:** PR review + merge

**Toplam Süre:** 4-6 gün (paralel iş dahil)

## 🔗 Bağımlılıklar

- **P2 Çıktısı:** `colors.status.*` token'ları, `num-tight` utility
- **CI Setup:** Jest + GitHub Actions
- **Design Review:** StatusBadge renk/boyut variasyonları

## 📝 Notlar

- StatusBadge Storybook'a eklenecek (görsel QA için)
- i18n check'i pre-commit hook'a eklemek opsiyonel (developer experience)
- Format test'ler diğer helper fonksiyonlar için de şablon olacak

---

**Durum:** DRAFT - P2 tamamlandıktan sonra aktive edilecek
**Atanan:** TBD
**Milestone:** V1.3-P3
