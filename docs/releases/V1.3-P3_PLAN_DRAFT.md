# V1.3-P3 â€¢ UI-Guardrails Harmonization â€” Ã–N PLAN

## ğŸ“‹ Genel BakÄ±ÅŸ
P2'de oluÅŸturulan `colors.status.*` token'larÄ±nÄ± kullanarak UI genelinde durum gÃ¶stergelerini (alert chip, SLO badge, guardrail status) standartlaÅŸtÄ±rma ve i18n CI kontrolÃ¼ ekleme.

## ğŸ¯ Hedefler

1. **StatusBadge Unification**
   - Tek `StatusBadge` bileÅŸeni â†’ `status.*` token'larÄ± kullanÄ±r
   - Eski chip/tag/badge bileÅŸenlerini birleÅŸtir
   - Alert, SLO, Guardrail durum gÃ¶stergelerini standartlaÅŸtÄ±r

2. **i18n CI Gate**
   - `scripts/i18n-check.mjs` â†’ TR/EN anahtar paritesi kontrolÃ¼
   - CI'da otomatik yorum (eksik anahtarlar)
   - Pre-commit hook (opsiyonel)

3. **Format Helper Tests**
   - `lib/format.ts` â†’ Jest coverage %100
   - Edge case: negatif, sÄ±fÄ±r, Ã§ok bÃ¼yÃ¼k sayÄ±lar, null/undefined

4. **Settings Ä°yileÅŸtirmeleri**
   - Tema: "(light)" â†’ "(aydÄ±nlÄ±k)" (i18n)
   - Dil seÃ§ici gÃ¶rsel polish
   - Keyboard shortcuts display

## ğŸ“¦ Paket Ä°Ã§eriÄŸi (Tahmini 12-15 dosya)

### 1. StatusBadge BileÅŸeni (yeni)
```typescript
// apps/web-next/src/components/ui/StatusBadge.tsx
interface StatusBadgeProps {
  status: 'success' | 'warn' | 'error' | 'info' | 'neutral';
  label: string;
  size?: 'sm' | 'md' | 'lg';
  icon?: ReactNode;
}
```

**KullanÄ±m:**
```tsx
<StatusBadge status="success" label={t('status.healthy')} />
<StatusBadge status="error" label={t('status.down')} icon={<AlertIcon />} />
```

### 2. i18n Check Script
```javascript
// scripts/i18n-check.mjs
// TR/EN JSON'larÄ±nÄ± karÅŸÄ±laÅŸtÄ±r
// Eksik anahtarlarÄ± raporla
// Exit code: 0 (parity) veya 1 (mismatch)
```

**CI Entegrasyonu:**
```yaml
# .github/workflows/ci.yml
- name: i18n Parity Check
  run: pnpm i18n:check
```

### 3. Format Helper Tests
```typescript
// apps/web-next/src/lib/__tests__/format.test.ts
describe('formatCurrency', () => {
  it('formats positive numbers (TR locale)', () => {
    expect(formatCurrency(42500, 'tr-TR', 'USD')).toBe('42.500,00 $');
  });
  it('formats negative numbers', () => {
    expect(formatCurrency(-125.5, 'tr-TR', 'USD')).toBe('-125,50 $');
  });
  it('handles zero', () => {
    expect(formatCurrency(0, 'tr-TR', 'USD')).toBe('0,00 $');
  });
  it('handles very large numbers', () => {
    expect(formatCurrency(1234567890, 'tr-TR', 'USD')).toContain('1.234.567.890');
  });
});
```

### 4. Settings Page Refactor
```typescript
// Theme selector i18n
const themes = [
  { value: 'dark', label: t('settings.theme.dark') },
  { value: 'light', label: t('settings.theme.light') },
  { value: 'system', label: t('settings.theme.system') },
];
```

## ğŸ”„ Migration Path

### AÅŸama 1: StatusBadge OluÅŸtur
- [ ] BileÅŸen dosyasÄ±
- [ ] Storybook stories
- [ ] Unit tests
- [ ] `status.*` token entegrasyonu

### AÅŸama 2: Mevcut KullanÄ±mlarÄ± DeÄŸiÅŸtir
- [ ] Alert chip'leri â†’ StatusBadge
- [ ] SLOChip â†’ StatusBadge
- [ ] Guardrail status â†’ StatusBadge
- [ ] StatusPills â†’ StatusBadge (opsiyonel, zaten refactor edildi)

### AÅŸama 3: i18n Tooling
- [ ] `scripts/i18n-check.mjs`
- [ ] `package.json`: `"i18n:check": "node scripts/i18n-check.mjs"`
- [ ] CI workflow gÃ¼ncelle
- [ ] Pre-commit hook (opsiyonel)

### AÅŸama 4: Format Tests
- [ ] Jest setup
- [ ] `format.test.ts` tÃ¼m fonksiyonlar iÃ§in
- [ ] Coverage gate: %100

### AÅŸama 5: Settings Polish
- [ ] Tema i18n
- [ ] Dil seÃ§ici UX
- [ ] Keyboard shortcuts modal

## ğŸ“Š BaÅŸarÄ± Kriterleri

| Kriter | Hedef | Ã–lÃ§Ã¼m |
|--------|-------|-------|
| BileÅŸen BirleÅŸimi | Tek StatusBadge | Eski chip/badge bileÅŸenleri kaldÄ±rÄ±ldÄ± |
| i18n Parity | %100 TR/EN | CI check geÃ§iyor |
| Test Coverage | %100 format.ts | Jest report |
| Build Size | +2 KB max | Webpack bundle analyzer |
| Performance | <50 ms render | Chrome DevTools |

## âš ï¸ Riskler

| Risk | OlasÄ±lÄ±k | Etki | Azaltma |
|------|----------|------|---------|
| Eski bileÅŸen kullanÄ±mÄ± kaldÄ± | Orta | Orta | grep ile scan, deprecation warning |
| i18n check false positive | DÃ¼ÅŸÃ¼k | DÃ¼ÅŸÃ¼k | Whitelist mekanizmasÄ± |
| Format test edge case | Orta | DÃ¼ÅŸÃ¼k | Comprehensive test suite |

## ğŸš€ Rollout

1. **P3-Alpha:** StatusBadge + i18n check (1-2 gÃ¼n)
2. **P3-Beta:** Migration + format tests (2-3 gÃ¼n)
3. **P3-RC:** Settings polish + QA (1 gÃ¼n)
4. **P3-Final:** PR review + merge

**Toplam SÃ¼re:** 4-6 gÃ¼n (paralel iÅŸ dahil)

## ğŸ”— BaÄŸÄ±mlÄ±lÄ±klar

- **P2 Ã‡Ä±ktÄ±sÄ±:** `colors.status.*` token'larÄ±, `num-tight` utility
- **CI Setup:** Jest + GitHub Actions
- **Design Review:** StatusBadge renk/boyut variasyonlarÄ±

## ğŸ“ Notlar

- StatusBadge Storybook'a eklenecek (gÃ¶rsel QA iÃ§in)
- i18n check'i pre-commit hook'a eklemek opsiyonel (developer experience)
- Format test'ler diÄŸer helper fonksiyonlar iÃ§in de ÅŸablon olacak

---

**Durum:** DRAFT - P2 tamamlandÄ±ktan sonra aktive edilecek
**Atanan:** TBD
**Milestone:** V1.3-P3
