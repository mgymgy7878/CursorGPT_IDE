â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš¡ TEK-EKRAN OTO-TEÅHÄ°S + DÃœZELTME                     â•‘
â•‘  ERR_CONNECTION_REFUSED â†’ Otomatik TeÅŸhis + Fix         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ TEK-EKRAN OTO-TEÅHÄ°S + DÃœZELTME (PowerShell)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# === 0) TeÅŸhis: host ve docker gÃ¶rÃ¼nÃ¼mÃ¼
Write-Host "`n[0] Host port nabzÄ±" -ForegroundColor Cyan
$port=3003
$t = Test-NetConnection 127.0.0.1 -Port $port
$t | Select-Object ComputerName, RemotePort, TcpTestSucceeded

Write-Host "`n[0] Docker gÃ¶rÃ¼nÃ¼mÃ¼" -ForegroundColor Cyan
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# Container adÄ± (web|app|front|next)
$SVC=(docker ps --format "{{.Names}}" | Select-String -Pattern "web|app|front|next" | Select -First 1) | ForEach-Object { $_.ToString() }

# === 1) Duruma gÃ¶re karar
if (-not $SVC) {
  Write-Host "`n[1] Docker container yok â†’ Ä°stersen lokal dev'e geÃ§iyorum." -ForegroundColor Yellow
  # Lokal dev: portu temizle + net baÅŸlat
  try { pnpm dlx kill-port $port | Out-Null } catch {}
  Get-Process node -ErrorAction SilentlyContinue | Stop-Process -Force
  Set-Location -Path "apps/web-next"
  pnpm install
  rimraf .next 2>$null
  $env:PORT="$port"; $env:HOST="0.0.0.0"
  Write-Host "`nâ†’ Lokal dev baÅŸlÄ±yor: pnpm dev --port $port --host 0.0.0.0" -ForegroundColor Green
  pnpm dev --port $port --host 0.0.0.0 | tee dev.log
  exit
}

# Buradaysa docker var. Publish var mÄ±?
$ports=(docker ps --format "{{.Names}}|{{.Ports}}" | Where-Object {$_ -match $SVC}) -split "\|"
$pub=$ports[1]

if (-not $pub -or $pub -notmatch "0\.0\.0\.0:$port->") {
  Write-Host "`n[1] Port publish YOK/yanlÄ±ÅŸ â†’ compose ile dÃ¼zeltiyorum." -ForegroundColor Yellow
  # compose patch: 3003 dÄ±ÅŸ, 3003 iÃ§ (iÃ§te 3000 ise 3003:3000 yap)
  @"
services:
  web:
    build: .
    working_dir: /app/apps/web-next
    command: sh -c "pnpm install && pnpm dev --port 3003 --host 0.0.0.0"
    environment:
      - PORT=3003
      - HOST=0.0.0.0
    ports:
      - "3003:3003"
    volumes:
      - .:/app
"@ | Out-File -FilePath docker-compose.yml -Encoding utf8
  docker compose down -v
  docker compose up --build -d
}

Write-Host "`n[2] Container log (ready satÄ±rÄ±nÄ± ara)" -ForegroundColor Cyan
docker logs --tail 80 $SVC

Write-Host "`n[3] Ä°Ã§eriden gerÃ§ekten dinliyor mu?" -ForegroundColor Cyan
docker exec -it $SVC sh -lc 'ss -ltnp | (grep 3003 || grep 3000) || true'

Write-Host "`n[4] SaÄŸlÄ±k nabzÄ±" -ForegroundColor Cyan
curl -I http://127.0.0.1:$port/api/healthz

ğŸ” Ã‡IKTIYI OKUMA â€” HANGÄ° DURUMDA NE YAPACAKSIN?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ docker ps Ports boÅŸ â†’ compose'taki ports: yanlÄ±ÅŸ/eksik. 
   YukarÄ±daki makro docker-compose.yml'i doÄŸru ÅŸekilde yazar ve up --build -d yapar.

âœ… Log'da ÅŸu satÄ±rÄ± gÃ¶rmelisin: ready - started server on 0.0.0.0:3003.
   GÃ¶rmÃ¼yorsan hemen Ã¼stÃ¼ndeki ilk hata (module not found / TS error) dÃ¼zeltilecek asÄ±l konudur.

ğŸ” Ä°Ã§eriden ss -ltnp 3003/3000 gÃ¶stermiyorsa â†’ Next.js --host 0.0.0.0 almamÄ±ÅŸ; 
   makro bunu da veriyor.

ğŸ“Š Ä°Ã§eride 200 dÃ¶nÃ¼yor, dÄ±ÅŸarÄ±da refused â†’ publish eÅŸleÅŸmesi hatalÄ±: 
   iÃ§ port 3000 ise ports: ["3003:3000"].

âœ… MÄ°NÄ° KONTROL LÄ°STESÄ° (YeÅŸil Ekran)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ docker ps â†’ 0.0.0.0:3003->(3003|3000)/tcp gÃ¶rÃ¼nÃ¼yor
â–¡ Log â†’ ready - started server on 0.0.0.0:3003
â–¡ curl -I http://127.0.0.1:3003/api/healthz â†’ 200
â–¡ TarayÄ±cÄ± HTTP ile http://localhost:3003/
â–¡ Proxy/VPN loopback'i bozmuyor

ğŸ”¬ BÄ°LÄ°MSEL Ã–Z
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"Refused", fiziksel olarak kapÄ±da bekÃ§i yok demek. 
Ya dinleyen sÃ¼reÃ§ yok, ya yanlÄ±ÅŸ kapÄ±yÄ± aÃ§tÄ±k. 
YukarÄ±daki sekans bekÃ§iyi kapÄ±ya koyar, kapÄ±yÄ± da sokaÄŸa aÃ§ar. 
DevamÄ±nda gerÃ§ek veriyi baÄŸlayÄ±p duman testini koÅŸabilirsin.

ğŸ¯ RÄ°TÄ°M: 60 BPM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BaÅŸlat â†’ Ã–lÃ§ â†’ DÃ¼zelt

Log, en dÃ¼rÃ¼st sahne amiridir; "ready" geldiÄŸi anda perde aÃ§Ä±lÄ±r.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¬ MÃœZÄ°K!

