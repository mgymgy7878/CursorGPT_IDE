# V1.2 Preparation Roadmap
**Tarih:** 28 EylÃ¼l 2025  
**Durum:** v1.1 LOCKED â†’ v1.2 HAZIRLIK  
**Hedef:** BTCTurk Spot Order Flow + UI/Strategy Lab Integration

## V1.1 BAÅžARILAR (LOCKED)
âœ… **Canary Evidence System:** Tam operasyonel  
âœ… **Prometheus Metrics:** Aktif toplama  
âœ… **BTCTurk Proxy:** Ticker + Orderbook Ã§alÄ±ÅŸÄ±yor  
âœ… **PM2 Operations:** KalÄ±cÄ± Ã§alÄ±ÅŸtÄ±rma  
âœ… **SLO Monitoring:** GÃ¼nlÃ¼k rapor sistemi  
âœ… **Security Guardrails:** Kill-switch aktif  

## V1.2 HAZIRLIK ADIMLARI

### 1. BTCTurk Spot Order Flow (2-3 saat)
**Dosyalar:**
- `services/executor/src/routes/btcturk-orderflow.ts` âœ… (OluÅŸturuldu)
- `services/executor/src/index.ts` âœ… (Route eklendi)

**Endpoint'ler:**
- `POST /api/btcturk/orders/create` - Order oluÅŸturma (dry-run)
- `DELETE /api/btcturk/orders/:orderId` - Order iptal (dry-run)
- `GET /api/btcturk/orders/:orderId` - Order durumu (dry-run)
- `GET /api/btcturk/orders` - Order listesi (dry-run)

**Guardrails:**
- maxNotional: 1000 TRY
- paperTrading: true (dry-run mode)
- Notional validation

**Test SenaryolarÄ±:**
```bash
# Order Create Test
curl -X POST http://127.0.0.1:4001/api/btcturk/orders/create \
  -H "Content-Type: application/json" \
  -d '{"symbol":"BTCTRY","side":"BUY","quantity":0.001,"price":100000}'

# Order Cancel Test  
curl -X DELETE http://127.0.0.1:4001/api/btcturk/orders/dry_123

# Order Status Test
curl http://127.0.0.1:4001/api/btcturk/orders/dry_123

# Orders List Test
curl http://127.0.0.1:4001/api/btcturk/orders
```

### 2. UI/Strategy Lab Integration (1-2 saat)
**Dosyalar:**
- `apps/web-next/app/strategy-lab/page.tsx` (Mevcut)
- `apps/web-next/app/api/strategy/backtest/route.ts` (Yeni)

**Ã–zellikler:**
- Tek enstrÃ¼man backtest (BTCTRY)
- 2-3 parametre seti test
- CSV export functionality
- Mini backtest sonuÃ§larÄ±

**Backtest Parametreleri:**
```typescript
interface BacktestParams {
  symbol: "BTCTRY";
  startDate: string;
  endDate: string;
  initialCapital: number;
  strategy: "EMA_CROSS" | "RSI_OVERBOUGHT" | "BOLLINGER_BANDS";
  params: {
    ema_short: number;
    ema_long: number;
    rsi_period: number;
    rsi_threshold: number;
    bb_period: number;
    bb_std: number;
  };
}
```

### 3. Executor Metrics GeniÅŸletme (1 saat)
**Yeni Metrics:**
```typescript
// Canary duration histogram
export const canaryDurationMs = new client.Histogram({
  name: "executor_canary_duration_ms",
  help: "Canary dry-run duration",
  buckets: [50, 100, 200, 500, 1000, 2000, 5000],
  registers: [registry],
});

// BTCTurk HTTP latency histogram  
export const btcturkHttpLatencyMs = new client.Histogram({
  name: "executor_btcturk_http_latency_ms",
  help: "BTCTurk API HTTP latency",
  buckets: [100, 200, 500, 1000, 2000, 5000, 10000],
  registers: [registry],
});

// Order flow metrics
export const orderCreateTotal = new client.Counter({
  name: "executor_orders_create_total",
  help: "Order creation requests",
  labelNames: ["symbol", "side", "status"],
  registers: [registry],
});
```

### 4. Security & Guardrails (30 dk)
**Kill-Switch Durumu:**
- Production'da varsayÄ±lan ARMED
- Live canary confirm iÃ§in Ã§ift onay
- Threshold deÄŸiÅŸimi iÃ§in onay
- Model promote/downgrade iÃ§in onay

**Onay Gerektiren Ä°ÅŸler:**
```typescript
const REQUIRES_CONFIRM = [
  'canary_confirm_live',
  'threshold_change', 
  'model_promote',
  'model_downgrade',
  'real_order_flow'
];
```

## V1.2 IMPLEMENTATION PLAN

### Phase 1: BTCTurk Order Flow (BugÃ¼n)
1. âœ… Route'larÄ± oluÅŸtur
2. ðŸ”„ Executor'u yeniden build et
3. ðŸ”„ PM2 restart
4. ðŸ”„ Endpoint testleri
5. ðŸ”„ Guardrails doÄŸrulama

### Phase 2: UI Integration (YarÄ±n)
1. ðŸ”„ Strategy Lab backtest API
2. ðŸ”„ CSV export functionality  
3. ðŸ”„ Mini backtest UI
4. ðŸ”„ Results visualization

### Phase 3: Metrics & Monitoring (YarÄ±n)
1. ðŸ”„ Yeni metrics ekle
2. ðŸ”„ Prometheus alerts gÃ¼ncelle
3. ðŸ”„ SLO dashboard
4. ðŸ”„ Performance monitoring

## V1.2 SUCCESS CRITERIA
- [ ] BTCTurk order flow endpoints Ã§alÄ±ÅŸÄ±yor
- [ ] Guardrails aktif (maxNotional, paperTrading)
- [ ] UI backtest functionality
- [ ] CSV export Ã§alÄ±ÅŸÄ±yor
- [ ] Metrics toplama geniÅŸletildi
- [ ] Security onaylarÄ± implement edildi

## NEXT STEPS (BugÃ¼n)
1. **Executor Build & Restart:** Yeni route'larÄ± aktif et
2. **Order Flow Test:** BTCTurk endpoints test et
3. **Guardrails Verify:** Notional limits test et
4. **Documentation:** API docs gÃ¼ncelle

**HEALTH=GREEN** ðŸŸ¢ **V1.2=READY** ðŸš€
